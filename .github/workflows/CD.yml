name: CD

on:
  workflow_run:
    workflows: [ "CI" ]
    types:
      - completed
  workflow_dispatch:
  
jobs:
  dev-deploy:
    name: Render Dev Deploy
    environment: DEV
    runs-on: ubuntu-latest
    
    steps: 
      - name: Deploy to dev
        uses: johnbeynon/render-deploy-action@v0.0.8
        with:
           service-id: ${{ secrets.RENDER_SERVICE_ID_DEV }}
           api-key: ${{ secrets.RENDER_API_KEY_DEV }}
  
  # deploy-to-netlify-dev:
  #   name: Deploy to Netlify Dev
  #   runs-on: ubuntu-latest
  #   needs: dev-deploy
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v2
        
  #     - name: Install Node.js
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '20.x'
          
  #     - name: Install dependencies
  #       run: npm install

  #     - name: Build project
  #       run: npm run build

  #     - name: Publish to Netlify
  #       uses: nwtgck/actions-netlify@v1.2.3
  #       with:
  #         publish-dir: './dist'
  #         github-token: ${{ secrets.GITHUB_TOKEN }}
  #       env:
  #         NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
  #         NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID_DEV }}
  #       timeout-minutes: 1




  prod-deploy:
    name: Render Prod Deploy
    environment: PROD
    runs-on: ubuntu-latest
    
    steps: 
      - name: Deploy to prod
        uses: johnbeynon/render-deploy-action@v0.0.8
        with:
           service-id: ${{ secrets.RENDER_SERVICE_ID_PROD }}
           api-key: ${{ secrets.RENDER_API_KEY_PROD }}

  # deploy-to-netlify-prod:
  #   name: Deploy to Netlify Prod
  #   runs-on: ubuntu-latest
  #   needs: prod-deploy
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v2
        
  #     - name: Install Node.js
  #       uses: actions/setup-node@v2
  #       with:
  #         node-version: '20.x'
          
  #     - name: Install dependencies
  #       run: npm install

  #     - name: Build project
  #       run: npm run build

  #     - name: Publish to Netlify
  #       uses: nwtgck/actions-netlify@v1.2.3
  #       with:
  #         publish-dir: './dist'
  #         github-token: ${{ secrets.GITHUB_TOKEN }}
  #       env:
  #         NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
  #         NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID_PROD }}
  #         timeout-minutes: 1